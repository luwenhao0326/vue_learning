<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>天气预报官网</title>
    <link rel="stylesheet" href="./stylesheets/style.css">
    <link rel="stylesheet" href="/libs/bootstrap/css/bootstrap.css">
</head>


<body>
    <div id="d1"></div>
</body>
<script src="/libs/jquery.js"></script>
<script src="/libs/bootstrap/js/bootstrap.js"></script>
<script src="/libs/layer/layer.js"></script>
<script src="/libs/ejs.js"></script>
<script type="text/html" id="ban">
    <%if(new Date().getHours()>6&&new Date().getHours()<18){%>
    <div id="tq-box" style="background-image:url(../images/timg.jpg)">
    <%}else{%>
        <div id="tq-box" style="background-image:url(../images/night_1.jpg)">
    <%}%>
    <main class="container" id="main">
            <p class="mar-top">
                <img src="./images/i_localhost.png">
                <span id="chengshi" onclick="clickChengShi()">&emsp;<%=currentCity%></span>
            </p>
            <p class="mar-top mt2">
                <img id="pm25" src="./images/2.png">&emsp;
                <%if(pm25<=50){%>
                <span class="ylc"><%=pm25%>&nbsp;优</span>
                <%}else if(pm25<=100){%>
                    <span class="ylc"><%=pm25%>&nbsp;良</span>
                <%}else if(pm25<=150){%>
                    <span class="ylc"><%=pm25%>&nbsp;一般</span>
                    <%}else{%>
                        <span class="ylc"><%=pm25%>&nbsp;差</span> 
                <%}%>
            </p>
            <p class="mar-top">
                <span class="wd-big"><%=weather_data[0].date.substr(weather_data[0].date.lastIndexOf("：")+1,3)%></span>
                <%if(new Date().getHours()>6&&new Date().getHours()<18){%>
                <img class="wd-tq" src="./images/w0.png">
                <%}else{%>
                    <img src="./images/w30.png"> 
                <%}%>
                <span class="wd-tq-z"><%=weather_data[0].weather%></span>
            </p>
            <p class="mar-top">
                <img class="sd-img" src="./images/i_water.png">
                <span class="sd-z bfb">湿度48%</span>&emsp;&emsp;
                <img class="sd-img" src="./images/i_wind.png">
                <span class="sd-z "><%=weather_data[0].wind%></span>
            </p>
            <div class="opi-color">
                <table class="table">
                    <thead>
                        <tr>
                            <td>预报</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td colspan="3">4天预报</td>
                        </tr>
                    </thead>
                    <tbody>
                        <%for(let i = 0; i<weather_data.length;i++){%>
                        <tr>
                            <% let s = weather_data[i] %>
                            <td><%=s.date%></td>
                            <td>
                                <%if(s.weather=="晴"){%>
                                    <%if(new Date().getHours()>6&&new Date().getHours()<18){%>
                                    <img class="tab-tq" src="./images/w0.png">
                                    <%}else{%>
                                    <img class="tab-tq" src="./images/w30.png">
                                <%}%>
                                <%}else if(s.weather=="晴转多云"||"多云转晴"||"多云"){%>
                                    <%if(new Date().getHours()>6&&new Date().getHours()<18){%>
                                        <img class="tab-tq" src="./images/w1.png">
                                    <%}else{%>
                                        <img class="tab-tq" src="./images/w31.png">
                                    <%}%>
                                <%}%>
                                <%=s.weather%>
                            </td>
                            <td><%=s.temperature%></td>
                            <td><%=s.wind%></td>
                            <td>
                                    <%if(pm25<=50){%>
                                        <span class="btn-pm25 y"><%=pm25%>&nbsp;优</span>
                                        <%}else if(pm25<=100){%>
                                            <span class="btn-pm25 l"><%=pm25%>&nbsp;良</span>
                                        <%}else if(pm25<=150){%>
                                            <span class="btn-pm25 c"><%=pm25%>&nbsp;一般</span>
                                            <%}else{%>
                                                <span class="btn-pm25 zc><%=pm25%>&nbsp;差</span> 
                                        <%}%>
                            </td>
                        </tr>
                        <%}%>
                    </tbody>
                </table>
            </div>
            <div class="opi-color">
                <table class="table table-bordered shzs">
                    <thead>
                        <tr>
                            <td>生活指数</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <img src="./images/20.png" alt="">
                                <span>穿衣指数</span>
                                <p><%=index[0].des%></p>
                            </td>
                            <td>
                                <img src="./images/17.png" alt="">
                                <span>洗车指数</span>
                                <p><%=index[1].des%></p>
                            </td>
                            <td>
                                <img src="./images/12.png" alt="">
                                <span>感冒指数</span>
                                <p><%=index[2].des%></p>
                            </td>
                            <td>
                                <img src="./images/20.png" alt="">
                                <span>运动指数</span>
                                <p><%=index[3].des%></p>
                            </td>
                            <td>
                                <img src="./images/21.png" alt="">
                                <span>紫外线强度指数</span>
                                <p><%=index[4].des%></p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>
        <!-- 城市模态框 -->
        <div class="modal fade" id="csModal" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">选择城市</h4>
                        </div>
                        <div class="modal-body">
                            <form class="form-horizontal" id="add-form">
                                <div class="form-group">
                                    <label for="inputPassword3" class="col-sm-2 control-label" id="mt-cs">城市</label>
                                    <div class="col-sm-10">
                                        <input type="text" class="form-control" id="tell" name="cs_bc" >
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <button type="button" id="stu-sel" class="btn btn-primary" onclick="onclick1()">确认</button>
                        </div>
                    </div>
                </div>
            </div>
</script>

<script>

    $.getJSON("http://api.map.baidu.com/telematics/v3/weather?location=%E9%83%91%E5%B7%9E&output=json&ak=KrkaA9DvVjOR7F3mAy6kQBaIVe8TcT05&callback=?", function (res) {
        // console.log(res);
        let htmlStr = ejs.render($("#ban").text(), res.results[0]);
        $("#d1").html(htmlStr);

    })

    function clickChengShi() {
        $('#csModal').modal('show');
    }

    function onclick1(){
          $.getJSON("http://api.map.baidu.com/telematics/v3/weather?location="+$("#tell").val()+"&output=json&ak=KrkaA9DvVjOR7F3mAy6kQBaIVe8TcT05&callback=?",function(res){
            let Strhtml= ejs.render($("#ban").text(), res.results[0]);
            $('#csModal').modal('hide');
            $('.modal-backdrop').removeClass('modal-backdrop');
            $('body').removeClass('modal-open');
            $("#d1").html("");
            $("#d1").html(Strhtml);
          })
    }
</script>

</html>